#!/bin/bash
# extract_secrets.sh - Search files for common secrets and tokens
#
# Usage:
#   ./extract_secrets.sh <path>
#   ./extract_secrets.sh -h
#
# Example:
#   ./extract_secrets.sh /var/www/html

usage() {
  echo "Usage: $0 <directory>"
  echo "Example: $0 /var/www/html"
  exit 0
}

if [[ "$1" == "-h" || "$1" == "--help" ]]; then
  usage
fi

if [ -z "$1" ]; then
  usage
fi

TARGET_DIR="$1"
LOG="secret_hits_$(date +%Y%m%d_%H%M%S).log"

echo "[*] Searching $TARGET_DIR for secrets..."

grep -rIHn --color=always -E 'AKIA[0-9A-Z]{16}|AIza[0-9A-Za-z-_]{35}|password\\s*=|secret\\s*=|Bearer\\s+[A-Za-z0-9\\-_\\.]{10,}' "$TARGET_DIR" | tee "$LOG"

echo "[+] Results saved to $LOG"
