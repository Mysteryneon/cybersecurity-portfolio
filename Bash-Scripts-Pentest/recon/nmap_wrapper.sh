#!/bin/bash
# nmap_wrapper.sh - Multi-scan Nmap wrapper with timestamped output
#
# Usage:
#   ./nmap_wrapper.sh <target> [--full] [--udp]
#   ./nmap_wrapper.sh -h
#
# Examples:
#   ./nmap_wrapper.sh 192.168.1.10
#   ./nmap_wrapper.sh scanme.nmap.org --full
#
set -e

RED="\\033[1;31m"
GREEN="\\033[1;32m"
NC="\\033[0m" # No Color

usage() {
  echo -e "${RED}Usage: $0 <target> [--full] [--udp]${NC}"
  echo "  --full : Run full TCP port scan (1-65535)"
  echo "  --udp  : Include top 100 UDP ports scan"
  echo "  -h     : Show this help menu"
  exit 0
}

# Show help if requested
if [[ "$1" == "-h" || "$1" == "--help" ]]; then
  usage
fi

# Validate input
if [ -z "$1" ]; then
  usage
fi

TARGET=$1
shift
TS=$(date +"%Y%m%d_%H%M%S")
DIR="nmap_scans"
mkdir -p "$DIR"

echo -e "${GREEN}[*] Running basic scan on $TARGET...${NC}"
nmap -sC -sV -oN "$DIR/${TARGET}_basic_${TS}.txt" "$TARGET"

# Handle optional flags
while [[ $# -gt 0 ]]; do
  case "$1" in
    --full)
      echo -e "${GREEN}[*] Running full TCP port scan...${NC}"
      nmap -p- -T4 -oN "$DIR/${TARGET}_full_tcp_${TS}.txt" "$TARGET"
      ;;
    --udp)
      echo -e "${GREEN}[*] Running top UDP ports scan...${NC}"
      nmap -sU --top-ports 100 -oN "$DIR/${TARGET}_udp_${TS}.txt" "$TARGET"
      ;;
    *)
      usage
      ;;
  esac
  shift
done

echo -e "${GREEN}[+] All scans completed. Results saved in $DIR${NC}"
