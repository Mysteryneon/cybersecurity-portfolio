#!/bin/bash
# subdomain_enum.sh - Discover subdomains using crt.sh and Kali tools
#
# Usage:
#   ./subdomain_enum.sh <domain>
#   ./subdomain_enum.sh -h
#
# Description:
#   Attempts passive subdomain discovery via crt.sh, then checks if 'assetfinder'
#   or 'amass' are available in the Kali environment and uses them if present.

usage() {
  echo "Usage: $0 <domain>"
  echo "Example: $0 example.com"
  echo "This script uses crt.sh, assetfinder, or amass depending on availability."
  exit 0
}

if [[ "$1" == "-h" || "$1" == "--help" || -z "$1" ]]; then
  usage
fi

DOMAIN=$1

echo "[*] Searching crt.sh..."
curl -s "https://crt.sh/?q=%25.$DOMAIN&output=json" |
grep -oE '"name_value":"[^"]+"' |
cut -d':' -f2 | tr -d '\\"' |
sort -u

if command -v assetfinder &>/dev/null; then
  echo "[*] Running assetfinder..."
  assetfinder --subs-only "$DOMAIN" | sort -u
fi

if command -v amass &>/dev/null; then
  echo "[*] Running amass (passive)..."
  amass enum -passive -d "$DOMAIN" | sort -u
fi
